{
  "feature": "Skill Badges & Certifications",
  "workflow_type": "feature",
  "workflow_rationale": "This is a multi-service feature requiring database schema, backend queries, and frontend UI components. The feature workflow follows the natural dependency order: database schema first, then queries/types, then components, then pages, and finally integration.",
  "phases": [
    {
      "id": "phase-1-database",
      "name": "Database Schema",
      "type": "implementation",
      "description": "Create database tables for badges, worker_badges junction table, and badge_verifications. Include RLS policies and indexes.",
      "depends_on": [],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Create badges table with enum type for badge categories",
          "service": "database",
          "files_to_create": [
            "supabase/migrations/20260224_create_skill_badges.sql"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "supabase/migrations/001_initial_schema.sql",
            "supabase/migrations/20250222000002_create_worker_skills.sql"
          ],
          "verification": {
            "type": "command",
            "command": "supabase db reset --db-url 'postgresql://localhost:54322/postgres' 2>&1 | head -20",
            "expected": "Resetting database"
          },
          "status": "completed",
          "notes": "Created badge_category enum (skill, training, certification, specialization), badges table with id, name, slug, description, icon, category, is_certified, provider_id"
        },
        {
          "id": "subtask-1-2",
          "description": "Create worker_badges junction table with verification status",
          "service": "database",
          "files_to_create": [
            "supabase/migrations/20260224_add_worker_badges.sql"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "supabase/migrations/20250222000002_create_worker_skills.sql"
          ],
          "verification": {
            "type": "command",
            "command": "supabase migration up --db-url 'postgresql://localhost:54322/postgres'",
            "expected": "Applied migration"
          },
          "status": "completed",
          "notes": "Created worker_badges junction table with worker_id, badge_id, verification_status ENUM (pending, verified, rejected), verified_by (FK to businesses), verified_at timestamp, created_at. Includes indexes on worker_id, badge_id, verification_status, verified_by. RLS policies: workers can manage own badges, admins can manage all, businesses can verify their authorized badges. Note: supabase/ directory is gitignored, migration managed via Supabase CLI."
        },
        {
          "id": "subtask-1-3",
          "description": "Add RLS policies and indexes for badge tables",
          "service": "database",
          "files_to_modify": [
            "supabase/migrations/20260224_add_worker_badges.sql"
          ],
          "files_to_create": [],
          "patterns_from": [
            "supabase/migrations/20250222000002_create_worker_skills.sql"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify RLS policies are created: Workers can view their badges, admins can manage all badges, public can view badges"
          },
          "status": "completed",
          "notes": "Added public read policy 'Public can view worker badges' for public profile access. All RLS policies verified: Workers can view/insert/delete own badges, admins can view/insert/delete/update all badges, businesses can verify their authorized badges. Indexes exist on worker_id, badge_id, verification_status, verified_by."
        }
      ]
    },
    {
      "id": "phase-2-types-queries",
      "name": "Types and Database Queries",
      "type": "implementation",
      "description": "Create TypeScript types and Supabase query functions for badges",
      "depends_on": [
        "phase-1-database"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create badge types in lib/types/badge.ts",
          "service": "frontend",
          "files_to_create": [
            "lib/types/badge.ts"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "lib/types/job.ts"
          ],
          "verification": {
            "type": "command",
            "command": "npm run type-check",
            "expected": "no errors"
          },
          "status": "completed",
          "notes": "Created lib/types/badge.ts with Badge, WorkerBadge, BadgeCategory, BadgeVerificationStatus types. Added Create/Update input types, filter types, and response types. Manually updated lib/supabase/types.ts to include badges and worker_badges tables with enums. Type-check passed."
        },
        {
          "id": "subtask-2-2",
          "description": "Create badge query functions in lib/supabase/queries/badges.ts",
          "service": "frontend",
          "files_to_create": [
            "lib/supabase/queries/badges.ts"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "lib/supabase/queries/jobs.ts"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify functions are exported: getBadges, getWorkerBadges, requestBadge, verifyBadge, getWorkersByBadge"
          },
          "status": "completed",
          "notes": "Created lib/supabase/queries/badges.ts with all required CRUD functions: getBadges(), getWorkerBadges(workerId), requestBadge(), verifyBadge(), getWorkersByBadge(badgeId). Plus helper functions: getBadgeById, createBadge, updateBadge, deleteBadge, getPendingBadgeVerifications, searchBadges, getBadgesByProvider, getWorkerBadgeById, deleteWorkerBadge. All functions follow jobs.ts pattern with proper error handling. TypeScript check passed.",
          "updated_at": "2026-02-24T15:50:21.987244+00:00"
        },
        {
          "id": "subtask-2-3",
          "description": "Update Supabase types to include new badge tables",
          "service": "frontend",
          "files_to_create": [],
          "files_to_modify": [
            "lib/supabase/types.ts"
          ],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "npx supabase gen types typescript --local > lib/supabase/types.ts && echo 'Types regenerated'",
            "expected": "Types regenerated"
          },
          "status": "completed",
          "notes": "Verified all badge types present in lib/supabase/types.ts: badge_category enum (skill, training, certification, specialization), badge_verification_status enum (pending, verified, rejected), badges table with all columns, worker_badges junction table. Types were already in git from previous migration creation. File was restored from git history (was temporarily empty)."
        }
      ]
    },
    {
      "id": "phase-3-ui-components",
      "name": "UI Components",
      "type": "implementation",
      "description": "Create reusable UI components for displaying and managing badges",
      "depends_on": [
        "phase-2-types-queries"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create SkillBadgeDisplay component for showing badges",
          "service": "frontend",
          "files_to_create": [
            "components/badge/skill-badge-display.tsx"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "components/worker/kyc-status-badge.tsx",
            "components/worker/reliability-score.tsx"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify component renders badge with icon, name, description, and verification status"
          },
          "status": "pending",
          "notes": "Use class-variance-authority for variants like KycStatusBadge, show icon from badge.icon, show verified/pending status"
        },
        {
          "id": "subtask-3-2",
          "description": "Create BadgeVerificationForm component for badge requests",
          "service": "frontend",
          "files_to_create": [
            "components/badge/badge-verification-form.tsx"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "components/business/profile-form.tsx"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify form allows selecting badge and uploading verification document"
          },
          "status": "pending",
          "notes": "Form with BadgeSelect, file upload for certificate/document, submit button. Use react-hook-form + zod"
        },
        {
          "id": "subtask-3-3",
          "description": "Create BadgeFilterSelect component for filtering by badges",
          "service": "frontend",
          "files_to_create": [
            "components/badge/badge-filter-select.tsx"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "components/worker/skills-select.tsx"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify multi-select dropdown shows available badges and displays selected badges as removable chips"
          },
          "status": "pending",
          "notes": "Similar to SkillsSelect but for badges, supports filtering workers by badge type"
        },
        {
          "id": "subtask-3-4",
          "description": "Create BadgeGrid component for displaying badge collection",
          "service": "frontend",
          "files_to_create": [
            "components/badge/badge-grid.tsx"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "components/ui/card.tsx"
          ],
          "verification": {
            "type": "manual",
            "instructions": "Verify grid displays badges in card layout with icons and status"
          },
          "status": "pending",
          "notes": "Grid layout showing all badges with status indicators, empty state for no badges"
        }
      ]
    },
    {
      "id": "phase-4-worker-pages",
      "name": "Worker Dashboard Pages",
      "type": "implementation",
      "description": "Create worker-facing pages for viewing and requesting badges",
      "depends_on": [
        "phase-3-ui-components"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Create worker badges page at /worker/badges",
          "service": "frontend",
          "files_to_create": [
            "app/(dashboard)/worker/badges/page.tsx"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "app/(dashboard)/worker/wallet/page.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/worker/badges",
            "checks": [
              "Page loads without errors",
              "Shows user's badges",
              "Shows available badges to request"
            ]
          },
          "status": "pending",
          "notes": "Page showing earned badges (verified), pending badges, and available badges to request. Link to verification form"
        },
        {
          "id": "subtask-4-2",
          "description": "Add Badges item to worker navigation menu",
          "service": "frontend",
          "files_to_create": [],
          "files_to_modify": [
            "components/dashboard/navigation-config.ts"
          ],
          "patterns_from": [
            "components/dashboard/navigation-config.ts"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/worker/jobs",
            "checks": [
              "Sidebar shows Badges menu item",
              "Clicking navigates to /worker/badges"
            ]
          },
          "status": "pending",
          "notes": "Add { href: '/worker/badges', label: 'Badges', icon: Award } to workerNavItems"
        }
      ]
    },
    {
      "id": "phase-5-business-pages",
      "name": "Business Dashboard Pages",
      "type": "implementation",
      "description": "Create business-facing pages for finding workers by badges",
      "depends_on": [
        "phase-3-ui-components"
      ],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create worker search page with badge filtering at /business/workers",
          "service": "frontend",
          "files_to_create": [
            "app/(dashboard)/business/workers/page.tsx"
          ],
          "files_to_modify": [],
          "patterns_from": [
            "app/(dashboard)/business/jobs/page.tsx"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/business/workers",
            "checks": [
              "Page shows worker list",
              "Badge filter is visible",
              "Filtering works"
            ]
          },
          "status": "pending",
          "notes": "Page showing all workers with BadgeFilterSelect, display worker badges as chips in cards"
        },
        {
          "id": "subtask-5-2",
          "description": "Add Workers item to business navigation menu",
          "service": "frontend",
          "files_to_create": [],
          "files_to_modify": [
            "components/dashboard/navigation-config.ts"
          ],
          "patterns_from": [
            "components/dashboard/navigation-config.ts"
          ],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/business/jobs",
            "checks": [
              "Sidebar shows Workers menu item",
              "Clicking navigates to /business/workers"
            ]
          },
          "status": "pending",
          "notes": "Add { href: '/business/workers', label: 'Workers', icon: Users } to businessNavItems"
        }
      ]
    },
    {
      "id": "phase-6-integration",
      "name": "Integration & Polish",
      "type": "integration",
      "description": "Integrate badges into worker profiles, search results, and add final polish",
      "depends_on": [
        "phase-4-worker-pages",
        "phase-5-business-pages"
      ],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Display badges on worker profile cards in search results",
          "service": "frontend",
          "files_to_create": [],
          "files_to_modify": [
            "components/booking/worker-application-card.tsx"
          ],
          "patterns_from": [],
          "verification": {
            "type": "browser",
            "url": "http://localhost:3000/business/workers",
            "checks": [
              "Worker cards show badges",
              "Badged workers are highlighted"
            ]
          },
          "status": "pending",
          "notes": "Add badge chips to worker cards, highlight badged workers with visual distinction"
        },
        {
          "id": "subtask-6-2",
          "description": "Add badge count to reliability score and profile sections",
          "service": "frontend",
          "files_to_create": [],
          "files_to_modify": [
            "components/worker/reliability-score.tsx"
          ],
          "patterns_from": [],
          "verification": {
            "type": "manual",
            "instructions": "Verify badge count is displayed alongside reliability score"
          },
          "status": "pending",
          "notes": "Show badge count in worker profile sections and reliability score breakdown"
        },
        {
          "id": "subtask-6-3",
          "description": "End-to-end verification of badge workflow",
          "all_services": true,
          "files_to_create": [],
          "files_to_modify": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Worker requests a badge through verification form",
              "Badge appears in pending state on worker profile",
              "Admin verifies the badge",
              "Badge changes to verified state",
              "Business can filter workers by the new badge",
              "Badge displays on worker profile card"
            ]
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 6,
    "total_subtasks": 17,
    "services_involved": [
      "database",
      "frontend"
    ],
    "parallelism": {
      "max_parallel_phases": 2,
      "parallel_groups": [
        {
          "phases": [
            "phase-4-worker-pages",
            "phase-5-business-pages"
          ],
          "reason": "Both depend only on phase-3 (UI Components) and modify different route groups"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "1.2x faster than sequential with parallel execution"
    },
    "startup_command": "npm run dev"
  },
  "verification_strategy": {
    "risk_level": "medium",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": [
      "manual",
      "browser"
    ],
    "security_scanning_required": false,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "Workers can earn skill badges through verification",
      "Badges are displayed in worker profiles",
      "Businesses can filter workers by badge type",
      "Badges have visual icons and descriptions",
      "Training providers can issue certified badges",
      "Badge verification process prevents fraud",
      "Badged workers are highlighted in search results"
    ],
    "verification_steps": [
      {
        "name": "Type Check",
        "command": "npm run type-check",
        "expected_outcome": "No type errors",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Database Migration",
        "command": "supabase db reset --db-url 'postgresql://localhost:54322/postgres'",
        "expected_outcome": "Migration applies successfully",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Browser Verification - Worker Badges Page",
        "command": "Open http://localhost:3000/worker/badges",
        "expected_outcome": "Page loads, shows badges",
        "type": "browser",
        "required": true,
        "blocking": false
      },
      {
        "name": "Browser Verification - Business Workers Page",
        "command": "Open http://localhost:3000/business/workers",
        "expected_outcome": "Page loads, filtering works",
        "type": "browser",
        "required": true,
        "blocking": false
      }
    ],
    "reasoning": "Medium risk feature with database schema changes and new user-facing pages. Requires type checking, database migrations, and manual browser verification of UI components."
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": false,
      "commands": [],
      "minimum_coverage": null,
      "notes": "Project uses manual e2e testing instead of unit tests"
    },
    "integration_tests": {
      "required": false,
      "commands": [],
      "services_to_test": [],
      "notes": "Integration verified through manual testing"
    },
    "e2e_tests": {
      "required": true,
      "commands": [
        "Manual e2e testing following the workflow"
      ],
      "flows": [
        "worker-request-badge",
        "admin-verify-badge",
        "business-filter-by-badge"
      ]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:3000/worker/badges",
          "checks": [
            "renders",
            "no-console-errors",
            "badges-display"
          ]
        },
        {
          "url": "http://localhost:3000/business/workers",
          "checks": [
            "renders",
            "no-console-errors",
            "filter-works"
          ]
        }
      ]
    },
    "database_verification": {
      "required": true,
      "checks": [
        "migrations-exist",
        "migrations-applied",
        "rls-policies-created",
        "indexes-created"
      ]
    }
  },
  "qa_signoff": null,
  "status": "in_progress",
  "planStatus": "in_progress",
  "xstateState": "backlog",
  "executionPhase": "coding",
  "updated_at": "2026-02-24T15:50:40.044Z",
  "last_updated": "2026-02-24T15:50:21.987259+00:00"
}